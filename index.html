<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kasbaum Negócios Imobiliários</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3, h4, .font-serif { font-family: 'Playfair Display', serif; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
        
        /* Loader Animation */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #000;
            width: 24px;
            height: 24px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-[#FAFAFA] text-gray-900 selection:bg-black selection:text-white">

    <nav id="navbar" class="fixed top-0 w-full z-40 transition-all duration-500 py-6 border-b border-transparent">
        <div class="max-w-7xl mx-auto px-6 flex justify-between items-center">
            <div class="flex flex-col z-50 cursor-pointer group" onclick="window.scrollTo({top:0, behavior:'smooth'})">
                <h1 class="text-2xl font-bold tracking-tighter text-black transition-colors group-hover:opacity-80">KASBAUM</h1>
                <span class="text-[10px] tracking-[0.3em] uppercase text-gray-500">Negócios Imobiliários</span>
            </div>

            <div class="hidden md:flex items-center gap-8">
                <a href="#imoveis" class="text-sm font-medium text-gray-600 hover:text-black transition-colors">Imóveis</a>
                <a href="#conceito" class="text-sm font-medium text-gray-600 hover:text-black transition-colors">Conceito</a>
                <a href="#contato" class="text-sm font-medium text-gray-600 hover:text-black transition-colors">Contato</a>
                <a href="https://wa.me/5562982495522" target="_blank" class="px-6 py-2.5 bg-black text-white text-sm font-medium rounded-full hover:shadow-lg hover:scale-105 transition-all duration-300">
                    Fale com o Vinicius
                </a>
            </div>

            <button id="mobile-menu-btn" class="md:hidden p-2 z-50 text-black">
                <i data-lucide="menu"></i>
            </button>
        </div>
    </nav>

    <div id="mobile-menu" class="fixed inset-0 bg-white z-40 p-8 flex flex-col justify-center gap-6 transform translate-x-full transition-transform duration-300 md:hidden">
        <button id="close-menu-btn" class="absolute top-6 right-6 p-2"><i data-lucide="x"></i></button>
        <a href="#imoveis" class="text-3xl font-light text-gray-900 border-b border-gray-100 pb-4 mobile-link">Imóveis</a>
        <a href="#conceito" class="text-3xl font-light text-gray-900 border-b border-gray-100 pb-4 mobile-link">Conceito</a>
        <a href="#contato" class="text-3xl font-light text-gray-900 border-b border-gray-100 pb-4 mobile-link">Contato</a>
        <a href="https://wa.me/5562982495522" class="mt-4 w-full py-4 bg-black text-white text-center rounded-xl font-bold text-lg">Fale com o Vinicius</a>
    </div>

    <header class="relative pt-32 pb-20 px-6 md:pt-48 md:pb-32 overflow-hidden bg-white">
        <div class="absolute top-0 right-0 w-[800px] h-[800px] bg-gradient-to-b from-gray-100 to-transparent rounded-full blur-[120px] -translate-y-1/2 translate-x-1/3 opacity-60 pointer-events-none"></div>
        <div class="absolute bottom-0 left-0 w-[600px] h-[600px] bg-gray-50 rounded-full blur-[100px] translate-y-1/2 -translate-x-1/4 pointer-events-none"></div>

        <div class="max-w-7xl mx-auto relative z-10">
            <div class="max-w-4xl">
                <span class="inline-block py-1.5 px-4 border border-gray-200 rounded-full text-xs font-semibold text-gray-500 mb-8 bg-white/50 backdrop-blur-sm shadow-sm">
                    CRECI 30.942 GO
                </span>
                <h1 class="text-4xl md:text-7xl font-semibold text-black leading-[1.1] mb-8 font-serif tracking-tight">
                    Não vendo m². <br/> 
                    Vendo decisões <span class="text-gray-400 italic font-light">bem tomadas.</span>
                </h1>
                
                <div class="text-lg text-gray-500 font-light mb-12 max-w-2xl leading-relaxed space-y-2">
                    <p>Trabalho com dados, leitura real de mercado e decisões bem conduzidas.</p>
                    <p>Não inflaciono expectativas nem forço decisões. Entrego imóveis com critério, clareza e valor real.</p>
                </div>

                <div class="bg-white/80 backdrop-blur-xl border border-white/40 shadow-[0_8px_30px_rgb(0,0,0,0.04)] rounded-2xl p-2 flex flex-col md:flex-row gap-2 max-w-2xl ring-1 ring-gray-100">
                    <div class="flex-1 flex items-center px-4 bg-gray-50/50 rounded-xl h-14 hover:bg-gray-50 transition-colors group focus-within:bg-white ring-1 ring-transparent focus-within:ring-black/5">
                        <i data-lucide="search" class="text-gray-400 mr-3 w-5 h-5"></i>
                        <input id="search-input" type="text" placeholder="Busque por ID, condomínio ou bairro..." class="w-full bg-transparent outline-none text-gray-800 placeholder-gray-400 font-medium">
                    </div>
                    <div class="md:w-48 flex items-center px-4 bg-gray-50/50 rounded-xl h-14 hover:bg-gray-50 transition-colors relative group focus-within:bg-white ring-1 ring-transparent focus-within:ring-black/5">
                        <i data-lucide="map-pin" class="text-gray-400 mr-3 w-5 h-5"></i>
                        <select id="neighborhood-filter" class="w-full bg-transparent outline-none text-gray-800 appearance-none cursor-pointer font-medium z-10 pr-4">
                            <option value="todos">Localização</option>
                            </select>
                        <div class="absolute right-4 pointer-events-none text-gray-400 text-xs">▼</div>
                    </div>
                    <button onclick="scrollToGrid()" class="h-14 px-8 bg-black text-white rounded-xl font-medium hover:bg-gray-800 transition-all shadow-lg shadow-gray-200">
                        Buscar
                    </button>
                </div>
            </div>
        </div>
    </header>

    <section id="imoveis" class="py-20 px-6 bg-[#FAFAFA]">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-end mb-12 gap-6">
                <div>
                    <h2 class="text-2xl font-medium text-black mb-2">Coleção Exclusiva</h2>
                    <p class="text-gray-500 font-light">Imóveis selecionados em Goiânia e região.</p>
                </div>
                
                <div id="quick-filters" class="flex flex-wrap gap-2">
                    </div>
            </div>

            <div id="loading-state" class="flex flex-col items-center justify-center py-32 text-gray-400">
                <div class="loader mb-4"></div>
                <p class="font-light animate-pulse">Carregando imóveis...</p>
            </div>

            <div id="error-state" class="hidden text-center py-24 bg-white rounded-[2rem] border border-red-100">
                <div class="w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4 text-red-500">
                    <i data-lucide="alert-circle"></i>
                </div>
                <h3 class="text-lg font-medium text-red-600">Atenção</h3>
                <p id="error-message" class="text-gray-500 font-light mt-2 max-w-md mx-auto"></p>
            </div>

            <div id="properties-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16 hidden">
                </div>

            <div id="empty-state" class="hidden text-center py-24 bg-white rounded-[2rem] border border-dashed border-gray-200">
                <div class="w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400">
                    <i data-lucide="search"></i>
                </div>
                <h3 class="text-lg font-medium text-black">Nenhum imóvel encontrado</h3>
                <button onclick="resetFilters()" class="mt-6 px-6 py-2 text-sm font-bold bg-gray-100 hover:bg-black hover:text-white rounded-full transition-colors">
                    Limpar Filtros
                </button>
            </div>

            <div id="load-more-container" class="text-center pt-8 border-t border-gray-100 hidden">
                <button id="load-more-btn" class="group inline-flex items-center gap-2 px-8 py-4 bg-white border border-gray-300 text-black font-bold rounded-full hover:bg-black hover:text-white hover:border-black transition-all shadow-sm">
                    <i data-lucide="plus-circle" class="group-hover:rotate-90 transition-transform duration-300"></i>
                    Carregar Mais Imóveis
                </button>
                <p id="showing-count" class="text-xs text-gray-400 mt-4"></p>
            </div>
        </div>
    </section>

    <section id="conceito" class="py-32 bg-black text-white relative overflow-hidden">
        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10 mix-blend-overlay"></div>
        <div class="absolute top-0 right-0 w-[600px] h-[600px] bg-gradient-to-b from-gray-800 to-transparent rounded-full blur-[150px] opacity-40"></div>
        
        <div class="max-w-7xl mx-auto px-6 grid md:grid-cols-2 gap-20 items-center relative z-10">
            <div>
                <h2 class="text-4xl md:text-5xl font-serif mb-8 leading-tight">
                    Preço justo não é estratégia. <br/> <span class="text-gray-500 italic">É princípio.</span>
                </h2>
                <div class="text-gray-400 text-lg font-light leading-relaxed mb-10 max-w-md space-y-4">
                    <p>O mercado imobiliário é ruidoso. Meu trabalho é filtrar o ruído e entregar clareza.</p>
                    <p>Não vendo ilusões de valorização impossível. Vendo a segurança de um ativo sólido, analisado com rigor técnico e transparência absoluta.</p>
                    <p class="text-white font-medium border-l-2 border-white pl-4">"Um imóvel, para mim, é a identidade de quem o conquista."</p>
                </div>
                <a href="https://wa.me/5562982495522" target="_blank" class="inline-flex items-center gap-3 px-8 py-4 bg-white text-black rounded-full font-medium hover:bg-gray-200 transition-colors">
                    Iniciar Consultoria <i data-lucide="arrow-right" class="w-4 h-4"></i>
                </a>
            </div>
            
            <div class="relative">
                <div class="aspect-[3/4] rounded-[2rem] overflow-hidden bg-gray-900 border border-white/10 relative group">
                    <div class="absolute inset-0 bg-gray-800 flex items-center justify-center text-gray-600 font-serif text-4xl opacity-50">VK</div>
                    <img src="https://images.unsplash.com/photo-1560518883-ce09059eeffa?auto=format&fit=crop&q=80&w=800&sat=-100" alt="Vinicius Kasbaum" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-105 transition-all duration-700 grayscale hover:grayscale-0">
                    <div class="absolute inset-0 bg-gradient-to-t from-black via-black/20 to-transparent opacity-90"></div>
                    
                    <div class="absolute bottom-10 left-10">
                        <p class="text-3xl font-serif text-white mb-2">Vinicius Kasbaum</p>
                        <div class="flex flex-col gap-1">
                            <p class="text-sm text-gray-400 uppercase tracking-widest font-bold">Corretor Especialista</p>
                            <p class="text-xs text-gray-500 font-mono">CRECI 30.942 GO</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer id="contato" class="bg-[#FAFAFA] border-t border-gray-200 py-20">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex flex-col md:flex-row justify-between items-center gap-12 mb-16">
                <div class="text-center md:text-left">
                    <h3 class="text-2xl font-bold tracking-tighter text-black mb-2">KASBAUM</h3>
                    <p class="text-xs text-gray-400 uppercase tracking-widest">Goiânia, Goiás</p>
                </div>
                
                <div class="flex gap-8">
                    <a href="https://instagram.com/viniciuskasbaum" target="_blank" class="group flex flex-col items-center gap-2 text-gray-400 hover:text-black transition-colors">
                        <div class="p-4 bg-white border border-gray-200 rounded-full group-hover:border-black transition-colors shadow-sm">
                            <i data-lucide="instagram"></i>
                        </div>
                        <span class="text-xs font-bold uppercase">Instagram</span>
                    </a>
                    <a href="https://wa.me/5562982495522" target="_blank" class="group flex flex-col items-center gap-2 text-gray-400 hover:text-black transition-colors">
                        <div class="p-4 bg-white border border-gray-200 rounded-full group-hover:border-black transition-colors shadow-sm">
                            <i data-lucide="message-circle"></i>
                        </div>
                        <span class="text-xs font-bold uppercase">WhatsApp</span>
                    </a>
                    
                    <button onclick="openContactModal()" class="group flex flex-col items-center gap-2 text-gray-400 hover:text-black transition-colors cursor-pointer">
                        <div class="p-4 bg-white border border-gray-200 rounded-full group-hover:border-black transition-colors shadow-sm">
                            <i data-lucide="mail"></i>
                        </div>
                        <span class="text-xs font-bold uppercase">Email</span>
                    </button>
                </div>
            </div>
            
            <div class="border-t border-gray-200 pt-8 flex flex-col md:flex-row justify-between items-center text-xs text-gray-400 gap-4">
                <p>© 2024 Kasbaum Negócios Imobiliários. Todos os direitos reservados.</p>
                <div class="flex gap-6">
                    <a href="#" class="hover:text-black transition-colors">Política de Privacidade</a>
                    <a href="#" class="hover:text-black transition-colors">Termos de Uso</a>
                </div>
            </div>
        </div>
    </footer>

    <div id="modal-overlay" class="fixed inset-0 z-[100] hidden items-center justify-center p-0 md:p-6 animate-fade-in bg-black/60 backdrop-blur-sm">
        <div class="relative w-full h-full flex items-center justify-center pointer-events-none">
             <div class="pointer-events-auto bg-white w-full max-w-7xl h-full md:h-[90vh] md:rounded-[2rem] overflow-hidden shadow-2xl relative flex flex-col md:flex-row z-10 animate-zoom-in">
                <div id="modal-content" class="w-full h-full flex flex-col md:flex-row">
                    <div class="w-full h-full flex items-center justify-center text-gray-400">
                        <div class="loader mr-3"></div> Carregando detalhes...
                    </div>
                </div>
             </div>
             <button onclick="closeModal()" class="pointer-events-auto absolute top-4 right-4 md:top-10 md:right-10 z-[110] p-2 bg-white/90 backdrop-blur-md rounded-full text-black hover:bg-black hover:text-white transition-all shadow-lg border border-gray-100">
                <i data-lucide="x"></i>
             </button>
        </div>
    </div>

    <div id="contact-modal" class="fixed inset-0 z-[200] hidden items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fade-in">
        <div class="bg-white w-full max-w-lg rounded-2xl shadow-2xl relative p-8 animate-zoom-in">
            <button onclick="closeContactModal()" class="absolute top-4 right-4 p-2 text-gray-400 hover:text-black transition-colors">
                <i data-lucide="x"></i>
            </button>
            
            <h2 class="text-2xl font-serif font-bold text-black mb-2">Fale Conosco</h2>
            <p class="text-gray-500 text-sm mb-6">Preencha os dados abaixo para enviar uma mensagem diretamente para Vinicius Kasbaum.</p>
            
            <form onsubmit="sendEmail(event)" class="space-y-4">
                <div>
                    <label class="block text-xs font-bold uppercase text-gray-500 mb-1">Nome</label>
                    <input type="text" id="contact-name" class="w-full p-3 bg-gray-50 rounded-lg border border-gray-200 focus:border-black focus:ring-0 outline-none transition-all" placeholder="Seu nome">
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase text-gray-500 mb-1">E-mail <span class="text-red-500">*</span></label>
                    <input type="email" id="contact-email" required class="w-full p-3 bg-gray-50 rounded-lg border border-gray-200 focus:border-black focus:ring-0 outline-none transition-all" placeholder="seu@email.com">
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase text-gray-500 mb-1">Telefone <span class="text-red-500">*</span></label>
                    <input type="tel" id="contact-phone" required class="w-full p-3 bg-gray-50 rounded-lg border border-gray-200 focus:border-black focus:ring-0 outline-none transition-all" placeholder="(00) 00000-0000">
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase text-gray-500 mb-1">Mensagem</label>
                    <textarea id="contact-message" rows="3" class="w-full p-3 bg-gray-50 rounded-lg border border-gray-200 focus:border-black focus:ring-0 outline-none transition-all" placeholder="Olá, gostaria de mais informações..."></textarea>
                </div>
                
                <button type="submit" class="w-full py-4 bg-black text-white rounded-xl font-bold hover:bg-gray-800 transition-all flex items-center justify-center gap-2">
                    <i data-lucide="send"></i> Enviar Mensagem
                </button>
            </form>
        </div>
    </div>

    <script>
        // --- CONFIGURAÇÃO E ESTADO ---
        const DATA_URL = "https://script.google.com/macros/s/AKfycbz0-YxQeOec0L7fNVFSUGrRkV_box4SWHJ7mc1kbzaUi6OXpUe1gY2XOb6QQrfS6T_D/exec";
        const ITEMS_PER_PAGE = 10;
        
        let state = {
            properties: [],
            filtered: [],
            visibleCount: ITEMS_PER_PAGE,
            filterHood: 'todos',
            searchTerm: '',
            modalImageIdx: 0,
            currentModalProp: null 
        };

        // --- DOM ELEMENTS ---
        const els = {
            grid: document.getElementById('properties-grid'),
            loading: document.getElementById('loading-state'),
            empty: document.getElementById('empty-state'),
            error: document.getElementById('error-state'),
            errorMessage: document.getElementById('error-message'),
            loadMoreContainer: document.getElementById('load-more-container'),
            loadMoreBtn: document.getElementById('load-more-btn'),
            showingCount: document.getElementById('showing-count'),
            searchInput: document.getElementById('search-input'),
            hoodSelect: document.getElementById('neighborhood-filter'),
            quickFilters: document.getElementById('quick-filters'),
            modalOverlay: document.getElementById('modal-overlay'),
            modalContent: document.getElementById('modal-content'),
            contactModal: document.getElementById('contact-modal'),
            navbar: document.getElementById('navbar'),
            mobileMenuBtn: document.getElementById('mobile-menu-btn'),
            closeMenuBtn: document.getElementById('close-menu-btn'),
            mobileMenu: document.getElementById('mobile-menu')
        };

        // --- UTILITÁRIOS ---
        const formatBRL = (val) => {
            if (val === null || val === undefined) return "Sob Consulta";
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 }).format(val);
        };

        // --- MAPPER: JSON API (App Script) -> APP STRUCT ---
        const mapProperty = (item) => {
            return {
                ListingID: item.id || '',
                Title: item.titulo || 'Imóvel sem título',
                TransactionType: item.operacao || null, 
                Location: {
                    City: item.cidade || 'Goiânia',
                    Neighborhood: item.bairro || '',
                    Address: item.endereco || ''
                },
                Details: {
                    ListPrice: item.valor,
                    CondoFee: 0, 
                    Description: item.descricao || '',
                    LivingArea: item.area,
                    Bedrooms: Number(item.quartos) || 0,
                    Suites: Number(item.suites) || 0,
                    Bathrooms: Number(item.banheiros) || 0,
                    Garage: Number(item.vagas) || 0,
                    PropertyType: item.tipo || '',
                    Features: item.features || []
                },
                Media: item.fotos ? item.fotos : (item.foto ? [item.foto] : []),
                Url: item.url || ''
            };
        };

        // --- TRANSLATION MAP (PT-BR) - EXPANDED ---
        const featureTranslations = {
            // Correções Específicas
            "cooling": "Climatização",
            "builtin wardrobe": "Armários Embutidos",
            "garden area": "Área de Jardim",
            "barbecue balcony": "Varanda Gourmet",
            "exterior view": "Vista Externa",
            "large window": "Janelas Amplas",
            "large kitchen": "Cozinha Ampla",
            "dinner room": "Sala de Jantar",
            "security guard on duty": "Segurança 24h",
            "bicycles place": "Bicicletário",
            "gourmet kitchen": "Cozinha Gourmet",
            "beauty room": "Espaço de Beleza",
            "beauty center": "Espaço de Beleza",
            "kitchen cabinets": "Armários na Cozinha",
            
            // Lazer & Bem-Estar
            "pool": "Piscina", "swimming pool": "Piscina", "private pool": "Piscina Privativa", "indoor pool": "Piscina Coberta", "heated pool": "Piscina Aquecida", "kids pool": "Piscina Infantil", "lap pool": "Raia de Piscina", "infinity pool": "Piscina com Borda Infinita",
            "gym": "Academia", "fitness center": "Academia", "workout room": "Sala de Ginástica", "pilates studio": "Estúdio de Pilates", "yoga room": "Sala de Yoga", "crossfit": "Espaço Crossfit",
            "sauna": "Sauna", "dry sauna": "Sauna Seca", "wet sauna": "Sauna Úmida", "steam room": "Sauna a Vapor", "spa": "Spa", "massage room": "Sala de Massagem", "jacuzzi": "Jacuzzi", "hot tub": "Banheira de Hidromassagem",
            "playground": "Playground", "kids room": "Brinquedoteca", "toy library": "Brinquedoteca", "game room": "Salão de Jogos", "video game room": "Sala de Games",
            "party room": "Salão de Festas", "ballroom": "Salão de Festas", "gourmet area": "Espaço Gourmet", "gourmet balcony": "Varanda Gourmet", "barbecue": "Churrasqueira", "bbq": "Churrasqueira", "pizza oven": "Forno de Pizza", "cinema": "Cinema", "home theater": "Home Theater",
            "sports court": "Quadra Poliesportiva", "tennis court": "Quadra de Tênis", "soccer field": "Campo de Futebol", "squash court": "Quadra de Squash", "walking track": "Pista de Caminhada", "bike rack": "Bicicletário", "skate park": "Pista de Skate",
            "garden": "Jardim", "green area": "Área Verde", "orchard": "Pomar", "vegetable garden": "Horta", "pet place": "Espaço Pet", "pet care": "Pet Care", "dog run": "Espaço para Cães", "park": "Parque", "lake": "Lago",
            
            // Infraestrutura & Segurança
            "elevator": "Elevador", "lift": "Elevador", "service elevator": "Elevador de Serviço", "social elevator": "Elevador Social", "private elevator": "Elevador Privativo",
            "garage": "Garagem", "parking": "Estacionamento", "guest parking": "Vagas para Visitantes", "covered parking": "Estacionamento Coberto", "underground parking": "Estacionamento Subterrâneo", "valet parking": "Manobrista", "electric car charging station": "Carregador Carro Elétrico", "car wash": "Lava-jato",
            "security": "Segurança", "24h security": "Segurança 24h", "concierge": "Portaria", "doorman": "Porteiro", "gated community": "Condomínio Fechado", "access control": "Controle de Acesso", "cctv": "Circuito de Câmeras", "intercom": "Interfone", "alarm system": "Alarme", "electronic gate": "Portão Eletrônico", "fenced yard": "Quintal Cercado", "biometric access": "Acesso Biométrico",
            "generator": "Gerador", "solar energy": "Energia Solar", "water tank": "Caixa d'Água", "cistern": "Cisterna", "artesian well": "Poço Artesiano", "sewage system": "Rede de Esgoto", "paved street": "Rua Asfaltada",
            "accessibility": "Acessibilidade", "wheelchair access": "Acesso para Cadeirantes", "ramp": "Rampa", "elevator access": "Acesso por Elevador",
            "helipad": "Heliponto", "dock": "Pier", "boat slip": "Vaga para Barco", "hangar": "Hangar",
            "meeting room": "Sala de Reunião", "coworking": "Coworking", "office": "Escritório", "study": "Escritório", "library": "Biblioteca", "lobby": "Hall de Entrada", "reception": "Recepção", "conference room": "Sala de Conferência",
            
            // Características do Imóvel
            "air conditioning": "Ar Condicionado", "heating": "Aquecimento", "fireplace": "Lareira", "ceiling fan": "Ventilador de Teto", "soundproofing": "Isolamento Acústico",
            "balcony": "Varanda", "terrace": "Terraço", "deck": "Deck", "solarium": "Solarium", "backyard": "Quintal", "patio": "Pátio", "veranda": "Varanda",
            "furnished": "Mobiliado", "semi-furnished": "Semi-mobiliado", "unfurnished": "Sem Mobília", "built-in wardrobes": "Armários Embutidos", "closet": "Closet", "walk-in closet": "Closet", "custom furniture": "Móveis Planejados",
            "kitchen": "Cozinha", "american kitchen": "Cozinha Americana", "integrated kitchen": "Cozinha Integrada", "pantry": "Despensa", "laundry": "Lavanderia", "service area": "Área de Serviço", "maid's quarters": "Dependência de Empregada",
            "living room": "Sala de Estar", "dining room": "Sala de Jantar", "tv room": "Sala de TV", "home office": "Escritório",
            "suites": "Suítes", "master suite": "Suíte Master", "bedrooms": "Quartos", "bathrooms": "Banheiros", "lavatory": "Lavabo",
            "porcelain floor": "Piso Porcelanato", "wood floor": "Piso de Madeira", "ceramic floor": "Piso Cerâmico", "laminate floor": "Piso Laminado", "carpet": "Carpete", "marble floor": "Piso de Mármore", "granite floor": "Piso de Granito",
            "ocean view": "Vista para o Mar", "sea view": "Vista para o Mar", "mountain view": "Vista para Montanha", "city view": "Vista da Cidade", "lake view": "Vista para o Lago", "park view": "Vista para o Parque", "panoramic view": "Vista Panorâmica", "beach front": "Frente para o Mar", "waterfront": "Beira-mar/Rio",
            "corner lot": "Lote de Esquina", "high floor": "Andar Alto", "low floor": "Andar Baixo", "penthouse": "Cobertura", "duplex": "Duplex", "triplex": "Triplex", "loft": "Loft", "studio": "Studio",
            "smart home": "Automação Residencial", "internet": "Internet", "cable tv": "TV a Cabo", "gas pipeline": "Gás Encanado", "solar heating": "Aquecimento Solar",
            "near school": "Perto de Escolas", "near hospital": "Perto de Hospital", "near shopping": "Perto de Shopping", "near park": "Perto de Parque", "near public transport": "Perto de Transporte Público"
        };

        const translateFeature = (term) => {
            if (!term) return "";
            const cleanTerm = term.trim().toLowerCase(); 
            if (featureTranslations[cleanTerm]) return featureTranslations[cleanTerm];
            const key = Object.keys(featureTranslations).find(k => k.toLowerCase() === cleanTerm.toLowerCase());
            return key ? featureTranslations[key] : cleanTerm;
        };

        // --- LÓGICA PRINCIPAL ---

        async function init() {
            // Listeners
            window.addEventListener('scroll', () => {
                if (window.scrollY > 30) {
                    els.navbar.classList.add('bg-white/80', 'backdrop-blur-xl', 'py-4', 'shadow-sm');
                    els.navbar.classList.remove('py-6', 'border-transparent');
                } else {
                    els.navbar.classList.remove('bg-white/80', 'backdrop-blur-xl', 'py-4', 'shadow-sm');
                    els.navbar.classList.add('py-6', 'border-transparent');
                }
            });

            els.searchInput.addEventListener('input', (e) => { state.searchTerm = e.target.value; applyFilters(); });
            els.hoodSelect.addEventListener('change', (e) => { state.filterHood = e.target.value; applyFilters(); });
            els.loadMoreBtn.addEventListener('click', () => { state.visibleCount += ITEMS_PER_PAGE; renderGrid(); });
            
            // Mobile Menu
            els.mobileMenuBtn.addEventListener('click', () => els.mobileMenu.classList.remove('translate-x-full'));
            els.closeMenuBtn.addEventListener('click', () => els.mobileMenu.classList.add('translate-x-full'));
            document.querySelectorAll('.mobile-link').forEach(l => l.addEventListener('click', () => els.mobileMenu.classList.add('translate-x-full')));

            // --- CARREGAMENTO INICIAL (JSON) ---
            try {
                const res = await fetch(DATA_URL);
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                
                const jsonData = await res.json();
                
                // Mapeia os dados do resumo
                const data = jsonData.map(mapProperty);

                if (data.length > 0) {
                    state.properties = data;
                    populateHoods();
                    applyFilters();
                } else {
                    showError("Nenhum imóvel encontrado.");
                }
            } catch (e) {
                showError("Erro de conexão. Verifique sua internet ou a URL da API.");
                console.error(e);
            } finally {
                els.loading.classList.add('hidden');
            }
        }

        function populateHoods() {
            const hoods = [...new Set(state.properties.map(p => p.Location.Neighborhood).filter(Boolean))].sort();
            hoods.forEach(h => {
                const opt = document.createElement('option');
                opt.value = h;
                opt.textContent = h;
                els.hoodSelect.appendChild(opt);
            });

            let html = `<button onclick="setQuickFilter('todos')" class="filter-btn px-4 py-2 rounded-full text-xs font-bold border transition-all bg-black text-white border-black" data-val="todos">Todos</button>`;
            hoods.slice(0, 3).forEach(h => {
                html += `<button onclick="setQuickFilter('${h}')" class="filter-btn px-4 py-2 rounded-full text-xs font-bold border transition-all bg-white text-gray-500 border-gray-200 hover:border-black hover:text-black" data-val="${h}">${h}</button>`;
            });
            if(hoods.length > 3) {
                html += `<div class="px-4 py-2 rounded-full text-xs font-bold border bg-white text-gray-400 border-gray-100 flex items-center gap-1 cursor-default"><i data-lucide="filter" class="w-3 h-3"></i> +${hoods.length - 3} bairros</div>`;
            }
            els.quickFilters.innerHTML = html;
            lucide.createIcons();
        }

        window.setQuickFilter = (val) => {
            state.filterHood = val;
            els.hoodSelect.value = val;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.className = (btn.dataset.val === val) 
                    ? "filter-btn px-4 py-2 rounded-full text-xs font-bold border transition-all bg-black text-white border-black" 
                    : "filter-btn px-4 py-2 rounded-full text-xs font-bold border transition-all bg-white text-gray-500 border-gray-200 hover:border-black hover:text-black";
            });
            applyFilters();
        };

        function applyFilters() {
            const term = state.searchTerm.toLowerCase();
            const hoodFilter = state.filterHood;

            state.filtered = state.properties.filter(p => {
                const title = (p.Title || '').toLowerCase();
                const id = (p.ListingID || '').toLowerCase();
                const hood = (p.Location.Neighborhood || '').toLowerCase();
                const type = (p.Details.PropertyType || '').toLowerCase();

                const matchText = id.includes(term) || title.includes(term) || hood.includes(term) || type.includes(term);
                const matchHood = hoodFilter === 'todos' || hood === hoodFilter.toLowerCase();

                return matchText && matchHood;
            });
            renderGrid();
        }

        function renderGrid() {
            els.grid.innerHTML = '';
            
            if (state.filtered.length === 0) {
                els.grid.classList.add('hidden');
                els.empty.classList.remove('hidden');
                els.loadMoreContainer.classList.add('hidden');
                return;
            }

            els.empty.classList.add('hidden');
            els.grid.classList.remove('hidden');

            const toShow = state.filtered.slice(0, state.visibleCount);

            toShow.forEach(p => {
                const img = (p.Media && p.Media.length > 0) ? p.Media[0] : '';
                const fallbackImg = `<div class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-400 text-xs uppercase tracking-widest">Sem Imagem</div>`;
                
                // CONDITIONAL RENDER: Only show if > 0
                const bedsHtml = p.Details.Bedrooms > 0 
                    ? `<span class="flex items-center gap-1" title="Quartos"><i data-lucide="bed" class="w-3.5 h-3.5 text-black"></i> ${p.Details.Bedrooms}</span>` 
                    : '';

                const garageHtml = p.Details.Garage > 0 
                    ? `<span class="flex items-center gap-1" title="Vagas"><i data-lucide="car" class="w-3.5 h-3.5 text-black"></i> ${p.Details.Garage}</span>` 
                    : '';

                const areaHtml = p.Details.LivingArea 
                    ? `<span class="flex items-center gap-1 ml-auto text-black font-bold normal-case text-sm"><i data-lucide="maximize" class="w-3.5 h-3.5 text-black"></i> ${p.Details.LivingArea} m²</span>` 
                    : '';

                // Badge de Transação (Venda/Aluguel) - Só mostra se existir
                const badgeHtml = p.TransactionType 
                    ? `<div class="absolute top-4 left-4 z-20 flex gap-2"><span class="px-3 py-1.5 bg-white/95 backdrop-blur-md text-black text-[10px] font-bold uppercase tracking-wider rounded-lg shadow-sm border border-gray-100">${p.TransactionType}</span></div>` 
                    : '';

                const card = document.createElement('div');
                card.className = "group bg-white rounded-[1.5rem] border border-gray-100 overflow-hidden cursor-pointer hover:shadow-[0_20px_40px_-15px_rgba(0,0,0,0.1)] transition-all duration-500 hover:-translate-y-2 relative flex flex-col";
                card.onclick = () => openModal(p.ListingID);

                card.innerHTML = `
                    <div class="h-[280px] overflow-hidden relative bg-gray-100">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 z-10"></div>
                        ${img ? `<img src="${img}" alt="${p.Title}" loading="lazy" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700 ease-out" onerror="this.style.display='none';this.parentNode.innerHTML='<div class=\\'w-full h-full bg-gray-200 flex items-center justify-center text-gray-400\\'>FOTO INDISPONÍVEL</div>'">` : fallbackImg}
                        ${badgeHtml}
                        <div class="absolute bottom-4 right-4 z-20">
                            <span class="px-3 py-1.5 bg-black/80 backdrop-blur-md text-white text-[10px] font-bold tracking-widest rounded-lg shadow-sm flex items-center gap-1">
                                <i data-lucide="hash" class="w-3 h-3"></i> ${p.ListingID}
                            </span>
                        </div>
                    </div>
                    <div class="p-8 relative bg-white flex flex-col flex-grow">
                        <div class="absolute -top-6 right-8 w-12 h-12 bg-black text-white rounded-full flex items-center justify-center shadow-lg shadow-black/20 transform scale-0 group-hover:scale-100 transition-transform duration-300 z-30">
                            <i data-lucide="arrow-up-right" class="w-5 h-5"></i>
                        </div>
                        <h3 class="text-xl font-medium text-black mb-1 font-serif truncate">${p.Title}</h3>
                        <p class="text-sm text-gray-500 mb-6 font-light truncate">${p.Location.Neighborhood || ''} • ${p.Location.City || ''}</p>
                        
                        <div class="flex items-center gap-4 text-gray-400 text-xs font-medium uppercase tracking-wide border-t border-gray-100 pt-6 mt-auto">
                            ${bedsHtml}
                            ${garageHtml}
                            ${areaHtml}
                        </div>

                        <div class="mt-6 pt-2">
                            <p class="text-2xl font-light text-black tracking-tight">${formatBRL(p.Details.ListPrice)}</p>
                        </div>
                    </div>
                `;
                els.grid.appendChild(card);
            });

            if (state.visibleCount < state.filtered.length) {
                els.loadMoreContainer.classList.remove('hidden');
                els.showingCount.innerText = `Mostrando ${state.visibleCount} de ${state.filtered.length} imóveis`;
            } else {
                els.loadMoreContainer.classList.add('hidden');
            }
            lucide.createIcons();
        }

        function showError(msg) {
            els.loading.classList.add('hidden');
            els.grid.classList.add('hidden');
            els.error.classList.remove('hidden');
            els.errorMessage.innerText = msg;
        }

        window.scrollToGrid = () => document.getElementById('imoveis').scrollIntoView({behavior: 'smooth'});
        window.resetFilters = () => {
            state.searchTerm = ''; state.filterHood = 'todos'; els.searchInput.value = ''; els.hoodSelect.value = 'todos'; window.setQuickFilter('todos');
        };

        // --- MODAL: FETCH LAZY ---
        window.openModal = async (id) => {
            els.modalOverlay.classList.remove('hidden');
            els.modalOverlay.classList.add('flex');
            document.body.style.overflow = 'hidden'; 
            
            els.modalContent.innerHTML = `<div class="w-full h-full flex items-center justify-center text-gray-400"><div class="loader mr-3"></div> Carregando detalhes...</div>`;

            try {
                // Chama API para pegar detalhes completos
                const res = await fetch(`${DATA_URL}?id=${id}`);
                if (!res.ok) throw new Error('Falha ao carregar detalhes');
                const jsonDetail = await res.json();
                
                // Mapeia o objeto completo
                state.currentModalProp = mapProperty(jsonDetail);
                state.modalImageIdx = 0;
                renderModalContent(); 
            } catch (e) {
                console.error(e);
                els.modalContent.innerHTML = `<div class="w-full h-full flex flex-col items-center justify-center text-red-500"><i data-lucide="alert-circle" class="w-8 h-8 mb-2"></i><p>Erro ao carregar detalhes.</p><button onclick="closeModal()" class="mt-4 px-4 py-2 text-sm border rounded hover:bg-gray-50">Fechar</button></div>`;
                lucide.createIcons();
            }
        };

        window.closeModal = () => {
            els.modalOverlay.classList.add('hidden');
            els.modalOverlay.classList.remove('flex');
            document.body.style.overflow = 'unset';
            state.currentModalProp = null;
        };

        els.modalOverlay.addEventListener('click', (e) => {
            if (e.target === els.modalOverlay || e.target.classList.contains('pointer-events-none')) closeModal();
        });

        function renderModalContent() {
            const p = state.currentModalProp;
            const idx = state.modalImageIdx;
            const media = p.Media || [];
            const hasMedia = media.length > 0;
            const currentImg = hasMedia ? media[idx] : '';

            // Renderização de Características (Features)
            let featuresHtml = '';
            if (p.Details.Features && p.Details.Features.length > 0) {
                featuresHtml = `<div class="mb-8"><h3 class="text-sm font-bold uppercase tracking-widest text-black mb-3">Diferenciais</h3><div class="flex flex-wrap gap-2">`;
                p.Details.Features.forEach(f => {
                    featuresHtml += `<span class="px-3 py-1 bg-gray-50 border border-gray-100 rounded-full text-xs text-gray-600 flex items-center gap-1"><i data-lucide="check-circle-2" class="w-3 h-3 text-emerald-500"></i> ${translateFeature(f)}</span>`;
                });
                featuresHtml += `</div></div>`;
            }

            // GRID ITEMS CONDITIONALS (MODAL)
            const gridItems = [];
            
            // Área Privativa (Usando "Área Privativa" como label)
            if (p.Details.LivingArea) {
                gridItems.push(`<div class="flex items-center gap-3"><div class="p-2.5 bg-gray-50 rounded-xl text-black"><i data-lucide="maximize" class="w-4 h-4"></i></div><div><p class="text-sm font-bold text-black">${p.Details.LivingArea} m²</p><p class="text-[10px] text-gray-400 uppercase">Área Privativa</p></div></div>`);
            }
            if (p.Details.Bedrooms > 0) {
                gridItems.push(`<div class="flex items-center gap-3"><div class="p-2.5 bg-gray-50 rounded-xl text-black"><i data-lucide="bed" class="w-4 h-4"></i></div><div><p class="text-sm font-bold text-black">${p.Details.Bedrooms}</p><p class="text-[10px] text-gray-400 uppercase">Quartos</p></div></div>`);
            }
            if (p.Details.Suites > 0) {
                gridItems.push(`<div class="flex items-center gap-3"><div class="p-2.5 bg-gray-50 rounded-xl text-black"><i data-lucide="crown" class="w-4 h-4"></i></div><div><p class="text-sm font-bold text-black">${p.Details.Suites}</p><p class="text-[10px] text-gray-400 uppercase">Suítes</p></div></div>`);
            }
            if (p.Details.Garage > 0) {
                gridItems.push(`<div class="flex items-center gap-3"><div class="p-2.5 bg-gray-50 rounded-xl text-black"><i data-lucide="car" class="w-4 h-4"></i></div><div><p class="text-sm font-bold text-black">${p.Details.Garage}</p><p class="text-[10px] text-gray-400 uppercase">Vagas</p></div></div>`);
            }
            if (p.Details.Bathrooms > 0) {
                gridItems.push(`<div class="flex items-center gap-3"><div class="p-2.5 bg-gray-50 rounded-xl text-black"><i data-lucide="bath" class="w-4 h-4"></i></div><div><p class="text-sm font-bold text-black">${p.Details.Bathrooms}</p><p class="text-[10px] text-gray-400 uppercase">Banheiros</p></div></div>`);
            }

            els.modalContent.innerHTML = `
                <div class="w-full md:w-[65%] h-[40vh] md:h-full relative bg-zinc-900 group select-none flex items-center justify-center">
                    ${hasMedia ? `<img src="${currentImg}" class="w-full h-full object-contain md:object-cover transition-opacity duration-300">` : `<div class="text-gray-500 flex flex-col items-center"><i data-lucide="image-off" class="w-8 h-8 mb-2"></i><span>SEM FOTO</span></div>`}
                    ${hasMedia && media.length > 1 ? `
                        <div class="absolute inset-y-0 left-0 w-24 bg-gradient-to-r from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-start pl-4"><button onclick="prevImage()" class="p-3 bg-white/20 backdrop-blur-md border border-white/30 rounded-full text-white hover:bg-white hover:text-black transition-all"><i data-lucide="chevron-left"></i></button></div>
                        <div class="absolute inset-y-0 right-0 w-24 bg-gradient-to-l from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-end pr-4"><button onclick="nextImage()" class="p-3 bg-white/20 backdrop-blur-md border border-white/30 rounded-full text-white hover:bg-white hover:text-black transition-all"><i data-lucide="chevron-right"></i></button></div>
                        <div class="absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-2 z-20 overflow-x-auto max-w-[80%] px-2 scrollbar-hide">${media.map((_, i) => `<button onclick="setImage(${i})" class="h-1.5 rounded-full transition-all duration-300 flex-shrink-0 ${i === idx ? 'w-8 bg-white shadow-lg' : 'w-2 bg-white/40 hover:bg-white/60'}"></button>`).join('')}</div>
                    ` : ''}
                </div>
                <div class="w-full md:w-[35%] p-6 md:p-10 overflow-y-auto bg-white flex flex-col h-full">
                    <div class="flex items-center gap-2 mb-6">
                        ${p.TransactionType ? `<span class="px-3 py-1 bg-black text-white text-[10px] font-bold uppercase tracking-widest rounded-full">${p.TransactionType}</span>` : ''}
                        <span class="px-3 py-1 bg-gray-50 text-gray-500 text-[10px] font-bold uppercase tracking-widest rounded-full border border-gray-200">ID: ${p.ListingID}</span>
                        ${p.Details.PropertyType ? `<span class="px-3 py-1 bg-gray-50 text-gray-500 text-[10px] font-bold uppercase tracking-widest rounded-full border border-gray-200 ml-auto">${p.Details.PropertyType}</span>` : ''}
                    </div>
                    <h2 class="text-2xl md:text-3xl font-light text-black mb-2 leading-tight font-serif">${p.Title}</h2>
                    <div class="flex flex-col text-gray-500 mb-6 font-light text-sm gap-1">
                        <span class="flex items-center"><i data-lucide="map-pin" class="w-3.5 h-3.5 mr-1 text-black"></i> ${p.Location.Neighborhood || ''}, ${p.Location.City || ''}</span>
                        ${p.Location.Address ? `<span class="text-xs pl-5 text-gray-400">${p.Location.Address}</span>` : ''}
                    </div>
                    <div class="text-3xl md:text-4xl font-medium text-black mb-2 tracking-tight">${formatBRL(p.Details.ListPrice)}</div>
                    
                    <div class="grid grid-cols-2 gap-y-6 gap-x-4 mb-8 border-t border-b border-gray-100 py-8">
                        ${gridItems.join('')}
                    </div>
                    ${featuresHtml}
                    <div class="prose prose-sm prose-gray mb-10 max-w-none">
                        <h3 class="text-sm font-bold uppercase tracking-widest text-black mb-3">Sobre o Imóvel</h3>
                        <p class="text-gray-600 leading-relaxed font-light whitespace-pre-line text-justify">${p.Details.Description || ''}</p>
                    </div>
                    <div class="mt-auto space-y-3 pt-6 md:pt-0 sticky bottom-0 bg-white/95 backdrop-blur md:static pb-4 md:pb-0 border-t md:border-t-0 border-gray-100">
                        <a href="https://wa.me/5562982495522?text=Olá Vinicius, tenho interesse no imóvel ID: ${p.ListingID} - ${p.Title}" target="_blank" class="w-full py-4 bg-black text-white rounded-xl font-medium flex items-center justify-center gap-2 hover:shadow-[0_10px_20px_-10px_rgba(0,0,0,0.4)] hover:-translate-y-1 transition-all duration-300"><i data-lucide="message-circle" class="w-4 h-4"></i> Agendar Visita</a>
                        <button onclick="shareProp('${p.ListingID}')" class="w-full py-4 bg-white border border-gray-200 text-gray-900 rounded-xl font-medium flex items-center justify-center gap-2 hover:bg-gray-50 transition-all active:scale-95"><i data-lucide="share-2" class="w-4 h-4"></i> Compartilhar Imóvel</button>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        window.prevImage = () => { const len = state.currentModalProp.Media.length; state.modalImageIdx = (state.modalImageIdx - 1 + len) % len; renderModalContent(); };
        window.nextImage = () => { const len = state.currentModalProp.Media.length; state.modalImageIdx = (state.modalImageIdx + 1) % len; renderModalContent(); };
        window.setImage = (i) => { state.modalImageIdx = i; renderModalContent(); };
        window.shareProp = (id) => { const link = window.location.href.split('#')[0] + '#' + id; navigator.clipboard.writeText(link).then(() => alert('Link copiado!')).catch(() => prompt("Copie o link:", link)); };

        // --- CONTACT MODAL LOGIC ---
        window.openContactModal = () => {
            els.contactModal.classList.remove('hidden');
            els.contactModal.classList.add('flex');
            document.body.style.overflow = 'hidden';
        };

        window.closeContactModal = () => {
            els.contactModal.classList.add('hidden');
            els.contactModal.classList.remove('flex');
            document.body.style.overflow = 'unset';
        };

        window.sendEmail = (e) => {
            e.preventDefault();
            const name = document.getElementById('contact-name').value;
            const email = document.getElementById('contact-email').value;
            const phone = document.getElementById('contact-phone').value;
            const message = document.getElementById('contact-message').value;
            
            const subject = encodeURIComponent(`Contato via Site - ${name}`);
            const body = encodeURIComponent(
                `Nome: ${name}\n` +
                `E-mail: ${email}\n` +
                `Telefone: ${phone}\n\n` +
                `Mensagem:\n${message}`
            );
            
            window.location.href = `mailto:viniciuskasbaum@gmail.com?subject=${subject}&body=${body}`;
            closeContactModal();
        };

        // Close contact modal on outside click
        els.contactModal.addEventListener('click', (e) => {
             if (e.target === els.contactModal) closeContactModal();
        });

        // --- INIT ---
        init();

    </script>
</body>
</html>